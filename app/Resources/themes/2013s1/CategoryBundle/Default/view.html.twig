{% extends layout %}

{% block content %}

<header class="grid_8 alpha omega">
    <hgroup>
        {{ ('headers.'~page_type)|trans({}, 'category')|raw }}
    </hgroup>
</header>

<div class="grid_8 alpha omega">
  <div class="grid_6 push_2">
    <div class="grid_3 alpha">
      <a href="{{ url(app.request.attributes.get('_route'), {'show': 'overview'}) }}" class="show-by-overview">{{ 'category.selector.overview'|trans }}</a> / <a href="{{ url(app.request.attributes.get('_route'), {'show': 'look'}) }}" class="show-by-look">{{ 'category.selector.look'|trans }}</a>
    </div>

    {% if paginate %}
      <div class="grid_3 omega right">
        {% import "::macro.pager.html.twig" as p %}
        {{ p.pager(paginate, 'product-list') }}
      </div>
    {% endif %}
  </div>
</div>
<div class="grid_8 alpha omega row">
  <div class="grid_2 alpha sub-menu menu">
    {% render 'CMSBundle:Menu:menu' with {'type': 'cat', 'offset': cms_id } %}
  </div>
  <div class="product-list clearfix grid_6 omega row">
    <div class="old-item">
      {% for product in products %}
        {% if loop.index % 3 == 1 %}
          <div class="grid_6 alpha omega">
        {% endif %}
            <div class="block block-num-{{ loop.index }} grid_2 {% if loop.index % 3 == 1 and loop.index is not divisibleby(3) %} alpha {% endif %}{% if loop.index is divisibleby(3) %} omega {% endif %}">
              <a href="{{ product.url }}" title="{{ "more.product.info"|trans({'%name%' : product.title}) }}">
                {{ product_image_tag(product.image, '234x410', {
                  'alt' : product.title,
                  'class' : 'flip',
                  'data-flip': product_image_url(product.image_flip, '234x410'),
                  'height' : '410',
                  'width' : '234'
                }) }}
                {% if product.prices.sales is defined and show_new_price_badge == 1 %}
                <div class="new-price">{{ 'new.price'|trans }}</div>
                {% endif %}
              </a>
              <a href="{{ product.url }}" title="{{ "more.product.info"|trans({'%name%' : product.title}) }}">
                <span class="title">{{ product.title }}</span>
                <span class="prices">
                {% if product.prices.sales is defined %}
                  <span class="normal strike">{{ product.prices.normal.price|money }}</span>
                  <span class="discount">{{ product.prices.sales.price|money }}</span>
                {% else %}
                  <span class="normal">{{ product.prices.normal.price|money }}</span>
                {% endif %}
                </span>
              </a>
            </div>
        {% if loop.index is divisibleby(3) or loop.last %}
          </div>
        {% endif %}

      {% else %}

        <div class="out-of-stock">
          {{ 'all.products.out.of.stock'|trans }}
        </div>

      {% endfor %}
    </div>
  </div>

    {% if paginate %}
      <div class="grid_3 push_3 omega right">
        {% import "::macro.pager.html.twig" as p %}
        {{ p.pager(paginate, 'product-list') }}
      </div>
    {% endif %}
</div>

{#  yatzy js template used by the pager, do not delete ! #}

<script type="text/html" id="productItems">
  <div class="new-item">
    <? for(i=0, l=data.length; i<l; i++) {?>
      <? if((i+1)%3 === 1) {?>
        <div class="grid_6 alpha omega">
      <?}?>
      <div class="block block-num-<?=(i+1)?> grid_2 <? if((i+1)%3===1){?>alpha<?}?> <? if((i+1)%3===0){?>omega<?}?>">
        <a href="<?=data[i].url?>" title="<?=Translator.get('more.product.info', {'%name%' : data[i].title})?>">
          <img src="<?=data[i].image?>" alt="<?=data[i].title?>" class="flip" data-flip="<?=data[i].image_flip?>">
          {% if show_new_price_badge == 1 %}
            <? if(undefined !== data[i].prices.sales) {?>
            <div class="new-price">{{ 'new.price'|trans }}</div>
            <? }?>
          {% endif %}
        </a>
        <a href="<?=data[i].url?>" title="<?=Translator.get('more.product.info', {'%name%' : data[i].title})?>">
          <span class="title"><?=data[i].title?></span>
          <span class="prices">
          <? if(undefined === data[i].prices.sales) {?>
            <span class="normal"><?=data[i].prices.normal.formattet?></span>
          <?}else{?>
            <span class="normal strike"><?=data[i].prices.normal.formattet?></span>
            <span class="discount"><?=data[i].prices.sales.formattet?></span>
          <? }?>
          </span>
        </a>
      </div>
      <? if((i+1)%3 === 0 || (i+1) === l){?>
        </div>
      <?}?>
    <? }?>
  </div>
</script>


{% endblock %}
